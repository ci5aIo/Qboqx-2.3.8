<?php$item_guid = $vars['item_guid'];$description = $vars['description'];$referrer = $vars['referrer'];$item = get_entity($item_guid);$ts = time();$title = "New Observation";$tags = "";$state_params = array("name"    => "jot[state]",                      'align'   => 'horizontal',					  "value"   => 1,					  "options2" => array(					                   array("label" =>"Discovery",					                         "option" => 1,					                         "title" => "Initial observation"),					                   array("label" => "Resolve",					                         "option" => 2,					                         "title" => "Early attempts to resolve"),					                   array("label" => "Assign",					                         "option" => 3,					                         "title" => "Assign to a specialist"),					                   array("label" => "Accept",					                         "option" => 4,					                         "title" => "Accept the situation and move on"),					                   array("label" => "Complete",					                         "option" => 5,					                         "title" => "Assigned tasks are complete.")
					                   ),				      'default' => 1,					 );$state_selector = elgg_view('input/quebx_radio', $state_params);$script   = '<script>    $(document).ready(function(){       // clone effort node    	$(".clone-discovery-action").on("click", function(e){    		e.preventDefault();    		    		// clone the node    		var html = $(".discovery").html();    		$(html).insertBefore(".new_discovery");    	});    	// remove a node    	$(".remove-node").on("click", function(e){    		e.preventDefault();    		    		// remove the node    		$(this).parents("div").parents("div").eq(0).remove();    	});                    $("input[name=\'jot[state]\']").change(function() {           if($(this).val() == 1) {                 $("#Progress_discoveries_panel").show();                $("#Progress_efforts_panel").hide();                $("#Progress_assign_panel").hide();                $("#Progress_accept_panel").hide();                $("#Progress_complete_panel").hide();              }           if($(this).val() == 2) {                $("#Progress_discoveries_panel").hide();                $("#Progress_efforts_panel").show();                $("#Progress_assign_panel").hide();                $("#Progress_accept_panel").hide();                $("#Progress_complete_panel").hide();              }           if($(this).val() == 3) {                $("#Progress_discoveries_panel").hide();                $("#Progress_efforts_panel").hide();                $("#Progress_assign_panel").show();                $("#Progress_accept_panel").hide();                $("#Progress_complete_panel").hide();              }           if($(this).val() == 4) {                $("#Progress_discoveries_panel").hide();                $("#Progress_efforts_panel").hide();                $("#Progress_assign_panel").hide();                $("#Progress_accept_panel").show();                $("#Progress_complete_panel").hide();              }           if($(this).val() == 5) {                $("#Progress_discoveries_panel").hide();                $("#Progress_efforts_panel").hide();                $("#Progress_assign_panel").hide();                $("#Progress_accept_panel").hide();                $("#Progress_complete_panel").show();              }        });   });</script>';echo elgg_view('input/hidden', array('name' => 'item_guid', 'value' => $item_guid));echo elgg_view('input/hidden', array('name' => 'asset'    , 'value' => $vars['asset']));echo elgg_view('input/hidden', array('name' => 'referrer' , 'value' => $referrer));echo elgg_view('input/hidden', array('name' => 'subtype'  , 'value' => 'observation'));echo elgg_view('input/hidden', array('name' => 'state'    , 'value' => '1'));$content .= "<h3>Observation</h3>";$content .="Details of the experience that may help to resolve issues.    <div class='rTable' style='width:100%'>		<div class='rTableBody'>				<div class='rTableRow'>					<div class='rTableCell' style='width:0'>Stage                    </div>					<div class='rTableCell' style='width:0'>$state_selector                    </div>                </div>        </div>    </div>";    $discovery_form   .= "<p></p>    <div id='Progress_discoveries_panel' class='elgg-head' $style>";    $discovery_form  .= "	     <b>Discoveries</b><br>	        Interesting things that I learned during this experience:		<div class='rTable' style='width:100%'>			<div id='sortable_discovery' class='rTableBody'>				<div class='rTableRow pin'>					<div class='rTableCell' style='width:0'>".								elgg_view('output/url', array(								    'text' => '+',									'href' => '#',									'class' => 'elgg-button-submit-element clone-discovery-action' // unique class for jquery									))."		            </div>					<div class='rTableHead' style='width:10%; padding: 0px 0px'><span title='When this happened'>Date</span></div>					<div class='rTableHead' style='width:30%; padding: 0px 0px'><span title='What I did'>Action</span></div>					<div class='rTableHead' style='width:30%; padding: 0px 0px'><span title='What I observed'>Observation</span></div>					<div class='rTableHead' style='width:30%; padding: 0px 0px'><span title='What I learned'>Discovery</span></div>					<div class='rTableHead' style='width:0; padding: 0px 0px'></div>				</div>				";		// Populate blank lines	for ($i = $n+1; $i <= $n+3; $i++) {		$discovery_form  .= 		" 		<div class='rTableRow' style='cursor:move'>					<div class='rTableCell' style='width:0; padding: 0px 0px;text-align:center' title='move'>&#x205c</div>					<div class='rTableCell' style='width:10%; padding: 0px 0px;vertical-align:top' title='When this happened'>".elgg_view('input/date', array(													'name' => 'jot[discovery][date][]',											))."</div>					<div class='rTableCell' style='width:30%; padding: 0px 0px;vertical-align:top' title='What I did'>".elgg_view('input/longtext', array(									        		'name' => 'jot[discovery][action][]',									        		'class'=> 'rTableform',				                                    'style'=> 'height:17px',									        ))."</div>					<div class='rTableCell' style='width:30%; padding: 0px 0px;vertical-align:top' title='What I observed'>".elgg_view('input/longtext', array(									        		'name' => 'jot[discovery][observation][]',									        		'class'=> 'rTableform',				                                    'style'=> 'height:17px',									        ))."</div>					<div class='rTableCell' style='width:30%; padding: 0px 0px;vertical-align:top' title='What I learned'>".elgg_view('input/longtext', array(									        		'name' => 'jot[discovery][discovery][]',									        		'class'=> 'rTableform',				                                    'style'=> 'height:17px',									        ))."</div>					<div class='rTableCell' style='width:0; padding: 0px 0px' title='remove'><a href='#' class='remove-node'>".elgg_view_icon('delete-alt')."</a></div>				</div>";	}	$discovery_form  .="	        <div class='new_discovery'></div>    	</div>    </div></div>";$effort_add_button = "<a title='add effort' class='elgg-button-submit-element add-effort' style='cursor:pointer;height:14px;width:30px'>+</a>";$resolve_form .= "<p></p><div id='Progress_efforts_panel' class='elgg-head' $style>";$resolve_form .= "<b>Efforts to Resolve</b><br>    Attempts that I made to resolve the issue.<br>    $effort_add_button <span id='effort_button_label'>add effort</span>    <div class='rTable' style='width:100%'>		<div class='rTableBody'>        <ol style='list-style:decimal;padding-left:20px'>    	    <div class='rTableRow' style='cursor:move'>    			<div class='rTableCell' style='width:100%;padding:0px'>                <li>".    		      elgg_view('input/text', array(    				'name'        => 'jot[effort][title][]',    				'class'       => 'last_effort',    	      	    'placeholder' => 'Effort to Resolve',    			))."    		    </li>    			</div>    			<div class='rTableCell' style='width:35px;text-align:right;padding:0px 10px'><a title='remove step' href='#' class='remove-node'>".elgg_view_icon('delete-alt')."</a></div>    				</div>";$resolve_form .= "<div class='new_effort'></div>";$resolve_form .= "	    </ol>	    </div>    </div></div>";$assign_form = "<p></p><div id='Progress_assign_panel' class='elgg-head' $style>";$assign_form .= "<b>Assign to a specialist</b><br>    Early attempts to resolve were unsuccessful.  Time for the experts.<br>";$assign_form .= "</div>";echo $content.     $discovery_form.     $resolve_form.     $assign_form;echo "<div id='line_store' style='visibility: hidden; display:inline-block;'>	<div class='discovery'>		<div class='rTableRow' style='cursor:move'>			<div class='rTableCell' style='width:0; padding: 0px 0px;text-align:center' title='move'>&#x205c</div>			<div class='rTableCell' style='width:10%; padding: 0px 0px;vertical-align:top' title='When this happened'>".elgg_view('input/date', array(											'name' => 'jot[discovery][date][]',									))."</div>			<div class='rTableCell' style='width:30%; padding: 0px 0px;vertical-align:top' title='What I did'>".elgg_view('input/longtext', array(							        		'name' => 'jot[discovery][action][]',							        		'class'=> 'rTableform',			                                'style'=> 'height:17px',							        ))."</div>			<div class='rTableCell' style='width:30%; padding: 0px 0px;vertical-align:top' title='What I observed'>".elgg_view('input/longtext', array(							        		'name' => 'jot[discovery][observation][]',							        		'class'=> 'rTableform',			                                'style'=> 'height:17px',							        ))."</div>			<div class='rTableCell' style='width:30%; padding: 0px 0px;vertical-align:top' title='What I learned'>".elgg_view('input/longtext', array(							        		'name' => 'jot[discovery][discovery][]',							        		'class'=> 'rTableform',			                                'style'=> 'height:17px',							        ))."</div>			<div class='rTableCell' style='width:0; padding: 0px 0px' title='remove'><a href='#' class='remove-node'>".elgg_view_icon('delete-alt')."</a></div>		</div>	</div>		<div class='resolve_effort'>	    <div class='rTableRow' style='cursor:move'>			<div class='rTableCell' style='width:100%;padding:0px'>            <li>".		      elgg_view('input/text', array(				'name'        => 'jot[effort][title][]',				'class'       => 'last_effort',	      	    'placeholder' => 'Effort to Resolve',			))."		    </li>			</div>			<div class='rTableCell' style='width:35px;text-align:right;padding:0px 10px'><a title='remove step' href='#' class='remove-node'>".elgg_view_icon('delete-alt')."</a></div>		</div>	</div></div>";echo $script;